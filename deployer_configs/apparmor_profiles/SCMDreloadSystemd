# Call this profile by putting this line in the SCMDsudo profile
#profile SCMDsudo flags=(enforce) {
#....
  /usr/bin/systemctl rmpx -> SCMDreloadSystemd,
  /usr/bin/systemd-analyze rmpx -> SCMDreloadSystemd,
#....
#}
# Reload profile designed for `systemd-analyze verify */path/to/servicefile*`, `systemctl restart *service*`, `systemctl is-active *service*`, `systemctl daemon-reload`
profile SCMDreloadSystemd flags=(enforce) {
  # Systemd self accesses
  /usr/bin/systemctl r,
  signal receive set=(term, cont) peer=SCMDreloadSystemd,
  signal send set=(term, cont) peer=SCMDreloadSystemd,
  capability net_admin,
  capability sys_resource,
  deny ptrace read peer=unconfined,
  unix (create, setopt, connect, getattr, getopt, send, receive) type=stream,
  /etc/ld.so.cache r,
  /usr/lib/*-linux-gnu*/ld-linux-*.so.* rm,
  /usr/lib/*-linux-gnu*/libcap.so.* rm,
  /usr/lib/*-linux-gnu*/libselinux.so.* rm,
  /usr/lib/*-linux-gnu*/liblzma.so.* rm,
  /usr/lib/*-linux-gnu*/liblz4.so.* rm,
  /usr/lib/*-linux-gnu*/libzstd.so.* rm,
  /usr/lib/*-linux-gnu*/libm.so.* rm,
  /usr/lib/*-linux-gnu*/libblkid.so.* rm,
  /usr/lib/*-linux-gnu*/libgcrypt.so.* rm,
  /usr/lib/*-linux-gnu*/libmount.so.* rm,
  /usr/lib/*-linux-gnu*/libcrypto.so.* rm,
  /usr/lib/*-linux-gnu*/libc.so.* rm,
  /usr/lib/*-linux-gnu*/libpcre*.so.* rm,
  /usr/lib/*-linux-gnu*/libgpg-error.so.* rm,
  /proc/filesystems r,
  /proc/sys/fs/nr_open r,
  /usr/lib/locale/locale-archive r,
  deny /usr/bin/systemd-tty-ask-password-agent rx,

  # analyze self accesses
  /usr/bin/systemd-analyze r,
  unix (create, getopt, setopt) type=dgram,
  /etc/default/locale r,
  /etc/locale.alias r,
  /usr/ r,
  /usr/lib/*-linux-gnu*/systemd/libsystemd-core-*.so rm,
  /usr/lib/*-linux-gnu*/systemd/libsystemd-shared-*.so rm,
  /usr/lib/*-linux-gnu*/libseccomp.so.* rm,
  /usr/lib/*-linux-gnu*/libpam.so.* rm,
  /usr/lib/*-linux-gnu*/libaudit.so.* rm,
  /usr/lib/*-linux-gnu*/libkmod.so.* rm,
  /usr/lib/*-linux-gnu*/libapparmor.so.* rm,
  /usr/lib/*-linux-gnu*/libacl.so.* rm,
  /usr/lib/*-linux-gnu*/libcrypt.so.* rm,
  /usr/lib/*-linux-gnu*/libip*tc.so.* rm,
  /usr/lib/*-linux-gnu*/libcap-ng.so.* rm,
  /usr/share/zoneinfo/** r,
  /proc/sys/kernel/cap_last_cap r,
  /proc/sys/kernel/osrelease r,
  /proc/[1-9]*/status r,
  /proc/[1-9]*/comm r,
  /proc/1/environ r,
  /proc/cmdline r,
  /run/systemd/system/ r,
  /tmp/systemd-analyze-*/ rw,
  /tmp/systemd-temporary-*/ rw,
  /dev/null rw,
  # Validates man pages in unit files
  /usr/bin/man rmUx,

  # Systemd reload accesses
  /usr/lib/systemd/** r,
  /etc/systemd/** r,
}
